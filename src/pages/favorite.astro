---
import { HeaderPage } from "../components/header/HeaderPage";
import { Footer } from "../components/footer/FooterCustom";
import { FavoriteCarsManager } from "../components/favorites/FavoriteCarsManager";
import "../styles/global/styles.css";
import styles from "../styles/announcement/styles.module.css";
import { Background } from "../components/background/Background";
---

<head>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content={Astro.generator} />
  <title>Mis Favoritos</title>
</head>

<!-- PROTECCIÓN SIN PARPADEO -->
<style>
  #protected-content {
    display: none; /* Oculto hasta validar rol */
  }
</style>

<script>
  import { getLoggedUserRole } from "../utils/GetUserUtils";

  const role = getLoggedUserRole();

  // Rol válido: 1 = admin, 2 = usuario logueado
  if (role === 1 || role === 2) {
    const container = document.getElementById("protected-content");
    if (container) container.style.display = "block";
  } else {
    window.location.href = "/";
  }
</script>

<!-- CONTENIDO PROTEGIDO -->
<div id="protected-content">
  <div class={styles.page}>
    {/* HEADER */}
    <header class={styles.header}>
      <HeaderPage client:load />
    </header>

    {/* CONTENIDO PRINCIPAL */}
    <main class={styles.main}>
      <FavoriteCarsManager client:load />
    </main>

    {/* FOOTER */}
    <footer class={styles.footer}>
      <Footer client:load />
    </footer>
    
    <Background client:load />
  </div>
</div>
